#!/bin/sh

# --- English Comments: Environment Setup ---
# Updates the D-Bus environment to ensure Wayland apps work correctly
dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=river
export MOZ_ENABLE_WAYLAND=1

# --- Keyboard Layout ---
# Use the combined "lv(apostrophe)" syntax for stability
riverctl keyboard-layout -variant apostrophe lv

riverctl set-repeat 50 300

# --- Variables ---
MOD="Super" # "Logo" ir Super/Windows taustiņš

# --- Keybindings: Applications ---
# map-add has been replaced by 'map' in River v0.3+
riverctl map normal $MOD T spawn kitty
riverctl map normal $MOD F spawn firefox
riverctl map normal $MOD R spawn "wofi --show drun"
riverctl map normal $MOD E spawn "kitty yazi"
riverctl map normal $MOD A spawn "$HOME/.config/river/scripts/wallpaper.sh"
riverctl map normal $MOD S spawn "sh -c 'fd -t f . ~ | wofi --search --insensitive | xargs -I {} xdg-open \"{}\"'"
riverctl map normal $MOD I spawn "kitty btop"
riverctl map normal Control+Alt Delete spawn "systemctl poweroff"
riverctl map normal $MOD P spawn "kitty flameshot gui"
# --- Sound Control ---

riverctl map normal None XF86AudioRaiseVolume spawn "wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+"

riverctl map normal None XF86AudioLowerVolume spawn "wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-"

# Ieslēgt/Izslēgt skaņu (Mute toggle)
riverctl map normal None XF86AudioMute spawn "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle"

# --- Keybindings: Window Management ---
riverctl map normal $MOD Q close
riverctl map normal $MOD+Shift E exit
riverctl map normal $MOD W toggle-fullscreen
riverctl map normal $MOD Space toggle-float
riverctl map-pointer normal $MOD BTN_LEFT move-view
riverctl map-pointer normal $MOD BTN_RIGHT resize-view
# --- Keybindings: Focus and Movement ---
# 'focus-view' is now 'focus-viewing-target'
riverctl map normal $MOD J focus-viewing-target next
riverctl map normal $MOD K focus-viewing-target previous
riverctl map normal $MOD+Shift J swap next
riverctl map normal $MOD+Shift K swap previous

# --- Keybindings: Tags (Workspaces) ---
for i in $(seq 1 9)
do
    tags=$((1 << ($i - 1)))
    riverctl map normal $MOD $i set-focused-tags $tags
    riverctl map normal $MOD+Shift $i set-view-tags $tags
done

# --- Layout Configuration ---
riverctl border-width 2
riverctl border-color-focused "0x51afef"
riverctl border-color-unfocused "0x282c34"

# IMPORTANT: Rivertile must be installed for windows to tile automatically
riverctl spawn "rivertile -view-padding 5 -outer-padding 5"

# --- Autostart ---
# Optional: Launch kitty on startup
# riverctl spawn kitty

# Status bar and Wallpaper (ensure you have waybar and swaybg installed)
pkill waybar; riverctl spawn waybar
pkill swaybg; riverctl spawn "swaybg -m fill -i /home/user/Pictures/Wallpapers/girl.jpg"
